{"version":3,"file":"ExportImageParameters-b1023819.js","sources":["../../node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{HandleOwnerMixin as s}from\"../../core/HandleOwner.js\";import{isSome as t}from\"../../core/maybe.js\";import{sqlAnd as i}from\"../../core/sql.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as l}from\"./commonProperties.js\";import{getLayerFloorFilterClause as n}from\"./floorFilterUtils.js\";import{isExportDynamic as y}from\"./sublayerUtils.js\";const m={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let c=class extends(s(r)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const r=n(this.floors,e);return e.toExportImageJSON(r)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&y(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(m[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=!!this.floors?.length,r=this.visibleSublayers.filter((r=>null!=r.definitionExpression||e&&null!=r.floorInfo));return r.length?JSON.stringify(r.reduce(((e,r)=>{const s=n(this.floors,r),o=i(s,r.definitionExpression);return t(o)&&(e[r.id]=o),e}),{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\"),this.commitProperty(\"timeExtent\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,o=0===r.minScale||t<=r.minScale,a=0===r.maxScale||t>=r.maxScale;r.visible&&(i||o&&a)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get(\"visibleSublayers\");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([o({readOnly:!0})],c.prototype,\"dynamicLayers\",null),e([o()],c.prototype,\"floors\",void 0),e([o({readOnly:!0})],c.prototype,\"hasDynamicLayers\",null),e([o()],c.prototype,\"layer\",null),e([o({readOnly:!0})],c.prototype,\"layers\",null),e([o({readOnly:!0})],c.prototype,\"layerDefs\",null),e([o({type:Number})],c.prototype,\"scale\",void 0),e([o(l)],c.prototype,\"timeExtent\",void 0),e([o({readOnly:!0})],c.prototype,\"version\",null),e([o({readOnly:!0})],c.prototype,\"visibleSublayers\",null),c=e([a(\"esri.layers.mixins.ExportImageParameters\")],c);export{c as ExportImageParameters};\n"],"names":["m","c","s","r","e","n","y","_a","o","i","t","a","l"],"mappings":"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"}