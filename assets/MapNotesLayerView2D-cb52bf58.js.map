{"version":3,"file":"MapNotesLayerView2D-cb52bf58.js","sources":["../../node_modules/@arcgis/core/views/2d/layers/MapNotesLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import i from\"../../../Graphic.js\";import s from\"../../../core/Collection.js\";import{isSome as t,isNone as r}from\"../../../core/maybe.js\";import{watch as a,on as h,initial as o}from\"../../../core/reactiveUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/Error.js\";import\"../../../core/has.js\";import{subclass as n}from\"../../../core/accessorSupport/decorators/subclass.js\";import{Container as p}from\"../engine/Container.js\";import{GroupContainer as c}from\"../engine/webgl/GroupContainer.js\";import{LayerView2DMixin as l}from\"./LayerView2D.js\";import g from\"./graphics/GraphicContainer.js\";import d from\"./graphics/GraphicsView2D.js\";import u from\"../../layers/LayerView.js\";const f=\"sublayers\",m=\"layerView\",w=Object.freeze({remove(){},pause(){},resume(){}});let y=class extends(l(u)){constructor(){super(...arguments),this._highlightIds=new Map,this.container=new c}async fetchPopupFeatures(e){return Array.from(this.graphicsViews(),(i=>i.hitTest(e).filter((e=>!!e.popupTemplate)))).flat()}*graphicsViews(){t(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():t(this._graphicsViews)?yield*this._graphicsViews:yield*[]}async hitTest(e,i){return Array.from(this.graphicsViews(),(i=>{const s=i.hitTest(e);if(t(this._graphicsViewsFeatureCollectionMap)){const e=this._graphicsViewsFeatureCollectionMap.get(i);for(const i of s)!i.popupTemplate&&e.popupTemplate&&(i.popupTemplate=e.popupTemplate),i.sourceLayer=i.layer=this.layer}return s})).flat().map((i=>({type:\"graphic\",graphic:i,layer:this.layer,mapPoint:e})))}highlight(e){let r;\"number\"==typeof e?r=[e]:e instanceof i?r=[e.uid]:Array.isArray(e)&&e.length>0?r=\"number\"==typeof e[0]?e:e.map((e=>e&&e.uid)):s.isCollection(e)&&(r=e.map((e=>e&&e.uid)).toArray());const a=r?.filter(t);return a?.length?(this._addHighlight(a),{remove:()=>{this._removeHighlight(a)}}):w}update(e){for(const i of this.graphicsViews())i.processUpdate(e)}attach(){const e=this.view,i=()=>this.requestUpdate(),s=this.layer.featureCollections;if(t(s)&&s.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const t of s){const s=new g(this.view.featuresTilingScheme),r=new d({view:e,graphics:t.source,renderer:t.renderer,requestUpdateCallback:i,container:s});this._graphicsViewsFeatureCollectionMap.set(r,t),this.container.addChild(r.container),this.addHandles([a((()=>t.visible),(e=>r.container.visible=e),o),a((()=>r.updating),(()=>this.notifyChange(\"updating\")),o)],m)}this._updateHighlight()}else t(this.layer.sublayers)&&this.addHandles(h((()=>this.layer.sublayers),\"change\",(()=>this._createGraphicsViews()),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),f)}detach(){this._destroyGraphicsViews(),this.removeHandles(f)}moveStart(){}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(m);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),r(this.layer.sublayers))return;const e=[],i=this.view,s=()=>this.requestUpdate();for(const t of this.layer.sublayers){const r=new p,h=new g(this.view.featuresTilingScheme);h.fadeTransitionEnabled=!0;const n=new d({view:i,graphics:t.graphics,requestUpdateCallback:s,container:h});this.addHandles([t.on(\"graphic-update\",n.graphicUpdateHandler),a((()=>t.visible),(e=>n.container.visible=e),o),a((()=>n.updating),(()=>this.notifyChange(\"updating\")),o)],m),r.addChild(n.container),this.container.addChild(r),e.push(n)}this._graphicsViews=e,this._updateHighlight()}_addHighlight(e){for(const i of e)if(this._highlightIds.has(i)){const e=this._highlightIds.get(i);this._highlightIds.set(i,e+1)}else this._highlightIds.set(i,1);this._updateHighlight()}_removeHighlight(e){for(const i of e)if(this._highlightIds.has(i)){const e=this._highlightIds.get(i)-1;0===e?this._highlightIds.delete(i):this._highlightIds.set(i,e)}this._updateHighlight()}_updateHighlight(){const e=Array.from(this._highlightIds.keys());for(const i of this.graphicsViews())i.setHighlight(e)}};y=e([n(\"esri.views.2d.layers.MapNotesLayerView2D\")],y);const _=y;export{_ as default};\n"],"names":["f","m","w","y","l","u","c","e","i","t","r","s","a","g","d","o","h","p","n","_"],"mappings":"8kDAIwzB,MAAMA,EAAE,YAAYC,EAAE,YAAYC,EAAE,OAAO,OAAO,CAAC,QAAQ,CAAE,EAAC,OAAO,GAAG,QAAQ,CAAA,CAAE,CAAC,EAAE,IAAIC,EAAE,cAAcC,EAAEC,CAAC,CAAE,CAAC,aAAa,CAAC,MAAM,GAAG,SAAS,EAAE,KAAK,cAAc,IAAI,IAAI,KAAK,UAAU,IAAIC,CAAC,CAAC,MAAM,mBAAmBC,EAAE,CAAC,OAAO,MAAM,KAAK,KAAK,cAAe,EAAEC,GAAGA,EAAE,QAAQD,CAAC,EAAE,OAAQ,GAAG,CAAC,CAAC,EAAE,aAAe,CAAA,EAAG,MAAM,CAAC,CAAC,eAAe,CAACE,EAAE,KAAK,kCAAkC,EAAE,MAAM,KAAK,mCAAmC,KAAI,EAAGA,EAAE,KAAK,cAAc,EAAE,MAAM,KAAK,eAAe,MAAM,CAAA,CAAE,CAAC,MAAM,QAAQF,EAAEC,EAAE,CAAC,OAAO,MAAM,KAAK,KAAK,gBAAiBA,GAAG,CAAC,MAAM,EAAEA,EAAE,QAAQD,CAAC,EAAE,GAAGE,EAAE,KAAK,kCAAkC,EAAE,CAAC,MAAMF,EAAE,KAAK,mCAAmC,IAAIC,CAAC,EAAE,UAAUA,KAAK,EAAE,CAACA,EAAE,eAAeD,EAAE,gBAAgBC,EAAE,cAAcD,EAAE,eAAeC,EAAE,YAAYA,EAAE,MAAM,KAAK,KAAK,CAAC,OAAO,CAAC,CAAG,EAAC,KAAI,EAAG,IAAKA,IAAI,CAAC,KAAK,UAAU,QAAQA,EAAE,MAAM,KAAK,MAAM,SAASD,CAAC,EAAE,CAAE,CAAC,UAAUA,EAAE,CAAC,IAAIG,EAAY,OAAOH,GAAjB,SAAmBG,EAAE,CAACH,CAAC,EAAEA,aAAaC,EAAEE,EAAE,CAACH,EAAE,GAAG,EAAE,MAAM,QAAQA,CAAC,GAAGA,EAAE,OAAO,EAAEG,EAAY,OAAOH,EAAE,CAAC,GAApB,SAAsBA,EAAEA,EAAE,IAAKA,GAAGA,GAAGA,EAAE,GAAK,EAACI,EAAE,aAAaJ,CAAC,IAAIG,EAAEH,EAAE,IAAKA,GAAGA,GAAGA,EAAE,GAAG,EAAG,QAAS,GAAE,MAAMK,EAAEF,GAAA,YAAAA,EAAG,OAAOD,GAAG,OAAOG,GAAA,MAAAA,EAAG,QAAQ,KAAK,cAAcA,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC,KAAK,iBAAiBA,CAAC,CAAC,CAAC,GAAGV,CAAC,CAAC,OAAOK,EAAE,CAAC,UAAUC,KAAK,KAAK,cAAa,EAAGA,EAAE,cAAcD,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAMA,EAAE,KAAK,KAAKC,EAAE,IAAI,KAAK,cAAe,EAACG,EAAE,KAAK,MAAM,mBAAmB,GAAGF,EAAEE,CAAC,GAAGA,EAAE,OAAO,CAAC,KAAK,mCAAmC,IAAI,IAAI,UAAUF,KAAKE,EAAE,CAAC,MAAMA,EAAE,IAAIE,EAAE,KAAK,KAAK,oBAAoB,EAAE,EAAE,IAAIC,EAAE,CAAC,KAAKP,EAAE,SAASE,EAAE,OAAO,SAASA,EAAE,SAAS,sBAAsBD,EAAE,UAAUG,CAAC,CAAC,EAAE,KAAK,mCAAmC,IAAI,EAAEF,CAAC,EAAE,KAAK,UAAU,SAAS,EAAE,SAAS,EAAE,KAAK,WAAW,CAACG,EAAG,IAAIH,EAAE,QAAUF,GAAG,EAAE,UAAU,QAAQA,EAAGQ,CAAC,EAAEH,EAAG,IAAI,EAAE,SAAW,IAAI,KAAK,aAAa,UAAU,EAAGG,CAAC,CAAC,EAAEd,CAAC,CAAC,CAAC,KAAK,iBAAgB,CAAE,MAAMQ,EAAE,KAAK,MAAM,SAAS,GAAG,KAAK,WAAWO,EAAG,IAAI,KAAK,MAAM,UAAW,SAAU,IAAI,KAAK,qBAAoB,EAAI,CAAC,cAAc,IAAI,KAAK,qBAAoB,EAAG,iBAAiB,IAAI,KAAK,sBAAuB,CAAA,CAAC,EAAEhB,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,sBAAqB,EAAG,KAAK,cAAcA,CAAC,CAAC,CAAC,WAAW,CAAE,CAAA,SAAS,CAAA,CAAE,YAAY,CAAC,UAAUO,KAAK,KAAK,cAAa,EAAGA,EAAE,WAAY,CAAA,CAAC,YAAY,CAAC,UAAUA,KAAK,KAAK,cAAa,EAAG,GAAGA,EAAE,SAAS,MAAM,GAAG,MAAM,EAAE,CAAC,uBAAuB,CAAC,KAAK,UAAU,kBAAmB,EAAC,KAAK,cAAcN,CAAC,EAAE,UAAUM,KAAK,KAAK,cAAe,EAACA,EAAE,QAAO,EAAG,KAAK,eAAe,KAAK,KAAK,mCAAmC,IAAI,CAAC,sBAAsB,CAAC,GAAG,KAAK,sBAAuB,EAACG,EAAE,KAAK,MAAM,SAAS,EAAE,OAAO,MAAMH,EAAE,CAAE,EAACC,EAAE,KAAK,KAAKG,EAAE,IAAI,KAAK,cAAa,EAAG,UAAUF,KAAK,KAAK,MAAM,UAAU,CAAC,MAAMC,EAAE,IAAIO,EAAED,EAAE,IAAIH,EAAE,KAAK,KAAK,oBAAoB,EAAEG,EAAE,sBAAsB,GAAG,MAAME,EAAE,IAAIJ,EAAE,CAAC,KAAKN,EAAE,SAASC,EAAE,SAAS,sBAAsBE,EAAE,UAAUK,CAAC,CAAC,EAAE,KAAK,WAAW,CAACP,EAAE,GAAG,iBAAiBS,EAAE,oBAAoB,EAAEN,EAAG,IAAIH,EAAE,QAAUF,GAAGW,EAAE,UAAU,QAAQX,EAAGQ,CAAC,EAAEH,EAAG,IAAIM,EAAE,SAAW,IAAI,KAAK,aAAa,UAAU,EAAGH,CAAC,CAAC,EAAEd,CAAC,EAAES,EAAE,SAASQ,EAAE,SAAS,EAAE,KAAK,UAAU,SAASR,CAAC,EAAEH,EAAE,KAAKW,CAAC,CAAC,CAAC,KAAK,eAAeX,EAAE,KAAK,iBAAkB,CAAA,CAAC,cAAcA,EAAE,CAAC,UAAUC,KAAKD,EAAE,GAAG,KAAK,cAAc,IAAIC,CAAC,EAAE,CAAC,MAAM,EAAE,KAAK,cAAc,IAAIA,CAAC,EAAE,KAAK,cAAc,IAAIA,EAAE,EAAE,CAAC,CAAC,MAAM,KAAK,cAAc,IAAIA,EAAE,CAAC,EAAE,KAAK,iBAAgB,CAAE,CAAC,iBAAiBD,EAAE,CAAC,UAAUC,KAAKD,EAAE,GAAG,KAAK,cAAc,IAAIC,CAAC,EAAE,CAAC,MAAM,EAAE,KAAK,cAAc,IAAIA,CAAC,EAAE,EAAM,IAAJ,EAAM,KAAK,cAAc,OAAOA,CAAC,EAAE,KAAK,cAAc,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,iBAAkB,CAAA,CAAC,kBAAkB,CAAC,MAAMD,EAAE,MAAM,KAAK,KAAK,cAAc,MAAM,EAAE,UAAUC,KAAK,KAAK,cAAe,EAACA,EAAE,aAAaD,CAAC,CAAC,CAAC,EAAEJ,EAAEI,EAAE,CAACW,EAAE,0CAA0C,CAAC,EAAEf,CAAC,EAAO,MAACgB,GAAEhB"}