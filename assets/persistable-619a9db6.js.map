{"version":3,"file":"persistable-619a9db6.js","sources":["../../node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isMultiOriginJSONMixin as t}from\"../../multiOriginJSONSupportUtils.js\";import{isAbsolute as r,isBlobProtocol as e,join as o,getPathExtension as s}from\"../../urlUtils.js\";import{generateUUID as n}from\"../../uuid.js\";import{getPropertyMetadata as i}from\"../metadata.js\";import{nameToId as a}from\"../PropertyOrigin.js\";import{propertyJSONMeta as p}from\"./property.js\";import{getResourceContentExtension as u}from\"../../../portal/support/resourceExtension.js\";import{r as c,t as l,M as m,i as f,p as y,a as d}from\"../../../chunks/persistableUrlUtils.js\";function g(t){const r=t?.origins??[void 0];return(e,o)=>{const s=h(t,e,o);for(const t of r){const r=p(e,t,o);for(const t in s)r[t]=s[t]}}}function h(t,r,e){if(\"resource\"===t?.type)return v(t,r,e);switch(t?.type??\"other\"){case\"other\":return{read:!0,write:!0};case\"url\":{const{read:t,write:r}=d;return{read:t,write:r}}}}function v(o,s,n){const p=i(s,n);return{type:String,read:(t,r,e)=>{const o=c(t,r,e);return p.type===String?o:\"function\"==typeof p.type?new p.type({url:o}):void 0},write:{writer(s,i,u,c){if(!c||!c.resources)return\"string\"==typeof s?void(i[u]=l(s,c)):void(i[u]=s.write({},c));const y=x(s),d=l(y,{...c,verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},m.NO),g=p.type!==String&&(!t(this)||c&&c.origin&&this.originIdOf(n)>a(c.origin)),h={object:this,propertyName:n,value:s,targetUrl:d,dest:i,targetPropertyName:u,context:c,params:o};c&&c.portalItem&&d&&!r(d)?g?w(h):j(h):c&&c.portalItem&&(null==d||null!=f(d)||e(d)||g)?U(h):i[u]=d}}}}function U(t){const{targetUrl:r,params:s,value:i,context:a,dest:p,targetPropertyName:c}=t;if(!a.portalItem)return;const l=y(r),m=l?.filename??n(),f=s?.prefix??l?.prefix,d=N(i,r,a),g=o(f,m),h=`${g}.${u(d)}`,v=a.portalItem.resourceFromPath(h);e(r)&&a.resources&&a.resources.pendingOperations.push(P(r).then((t=>{v.path=`${g}.${u(t)}`,p[c]=v.itemRelativeUrl})).catch((()=>{})));const U=s?.compress??!1;a.resources&&I({...t,resource:v,content:d,compress:U,updates:a.resources.toAdd}),p[c]=v.itemRelativeUrl}function w(t){const{context:r,targetUrl:e,params:o,value:n,dest:i,targetPropertyName:a}=t;if(!r.portalItem)return;const p=r.portalItem.resourceFromPath(e),c=N(n,e,r),l=u(c),m=s(p.path),f=o?.compress??!1;l===m?(r.resources&&I({...t,resource:p,content:c,compress:f,updates:r.resources.toUpdate}),i[a]=e):U(t)}function j({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}function I({object:t,propertyName:r,updates:e,resource:o,content:s,compress:n}){e.push({resource:o,content:s,compress:n,finish:e=>{O(t,r,e)}})}function N(t,r,e){return\"string\"==typeof t?{url:r}:new Blob([JSON.stringify(t.toJSON(e))],{type:\"application/json\"})}async function P(t){const r=(await import(\"../../../request.js\")).default,{data:e}=await r(t,{responseType:\"blob\"});return e}function x(t){return null==t?null:\"string\"==typeof t?t:t.url}function O(t,r,e){\"string\"==typeof t[r]?t[r]=e.url:t[r].url=e.url}export{g as persistable};\n"],"names":["g","t","r","e","o","h","p","v","d","s","n","i","c","u","l","y","x","m","a","w","j","f","U","N","P","I","O"],"mappings":"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"}