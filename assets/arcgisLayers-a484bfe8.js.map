{"version":3,"file":"arcgisLayers-a484bfe8.js","sources":["../../node_modules/@arcgis/core/layers/support/arcgisLayers.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{isNone as r,isSome as a}from\"../../core/maybe.js\";import{getFilename as t,urlToObject as s}from\"../../core/urlUtils.js\";import{parse as l,parseNonStandardSublayerUrl as o}from\"./arcgisLayerUrl.js\";import{fetchFeatureService as n}from\"./fetchService.js\";import{sceneServiceLayerTypeToClassName as u}from\"./layerUtils.js\";import{layerLookupMap as c}from\"./lazyLayerLoader.js\";import{fetchArcGISServiceJSON as i}from\"../../support/requestPresets.js\";const y={FeatureLayer:!0,SceneLayer:!0};async function m(e){const r=e.properties?.customParameters,a=await d(e.url,r),t={...e.properties,url:e.url};if(!a.sublayerIds)return null!=a.layerOrTableId&&(t.layerId=a.layerOrTableId,t.sourceJSON=a.sourceJSON),new a.Constructor(t);const s=new(0,(await import(\"../GroupLayer.js\")).default)({title:a.parsedUrl.title});return f(s,a,t),s}function p(e,r){return e?e.find((e=>e.id===r)):null}function f(e,r,t){function s(e,s){const l={...t,layerId:e,sublayerTitleMode:\"service-name\"};return a(s)&&(l.sourceJSON=s),new r.Constructor(l)}r.sublayerIds.forEach((a=>{const t=s(a,p(r.sublayerInfos,a));e.add(t)})),r.tableIds.forEach((a=>{const t=s(a,p(r.tableInfos,a));e.tables.add(t)}))}async function d(a,t){let s=l(a);if(r(s)&&(s=await I(a,t)),r(s))throw new e(\"arcgis-layers:url-mismatch\",\"The url '${url}' is not a valid arcgis resource\",{url:a});const{serverType:o,sublayer:n}=s;let c;const m={FeatureServer:\"FeatureLayer\",StreamServer:\"StreamLayer\",VectorTileServer:\"VectorTileLayer\"};switch(o){case\"MapServer\":if(null!=n)c=\"FeatureLayer\";else{c=await v(a,t)?\"TileLayer\":\"MapImageLayer\"}break;case\"ImageServer\":{const e=await i(a,{customParameters:t}),{tileInfo:r,cacheType:s}=e;c=r?\"LERC\"!==r?.format?.toUpperCase()||s&&\"elevation\"!==s.toLowerCase()?\"ImageryTileLayer\":\"ElevationLayer\":\"ImageryLayer\";break}case\"SceneServer\":{const e=await i(s.url.path,{customParameters:t});if(c=\"SceneLayer\",e){const r=e?.layers;if(\"Voxel\"===e?.layerType)c=\"VoxelLayer\";else if(r?.length){const e=r[0]?.layerType;null!=e&&null!=u[e]&&(c=u[e])}}break}default:c=m[o]}const p=\"FeatureServer\"===o,f={parsedUrl:s,Constructor:null,layerOrTableId:p?n:void 0,sublayerIds:null,tableIds:null};if(y[c]&&null==n){const e=await S(a,o,t);p&&(f.sublayerInfos=e.layerInfos,f.tableInfos=e.tableInfos);1!==e.layerIds.length+e.tableIds.length?(f.sublayerIds=e.layerIds,f.tableIds=e.tableIds):p&&(f.layerOrTableId=e.layerIds[0]??e.tableIds[0],f.sourceJSON=e.layerInfos?.[0]??e.tableInfos?.[0])}return f.Constructor=await w(c),f}async function I(e,r){const l=await i(e,{customParameters:r});let n=null,u=null;const c=l.type;if(\"Feature Layer\"===c||\"Table\"===c?(n=\"FeatureServer\",u=l.id??null):\"indexedVector\"===c?n=\"VectorTileServer\":l.hasOwnProperty(\"mapName\")?n=\"MapServer\":l.hasOwnProperty(\"bandCount\")&&l.hasOwnProperty(\"pixelSizeX\")?n=\"ImageServer\":l.hasOwnProperty(\"maxRecordCount\")&&l.hasOwnProperty(\"allowGeometryUpdates\")?n=\"FeatureServer\":l.hasOwnProperty(\"streamUrls\")?n=\"StreamServer\":b(l)?(n=\"SceneServer\",u=l.id):l.hasOwnProperty(\"layers\")&&b(l.layers?.[0])&&(n=\"SceneServer\"),!n)return null;const y=null!=u?o(e):null;return{title:a(y)&&l.name||t(e),serverType:n,sublayer:u,url:{path:a(y)?y.serviceUrl:s(e).path}}}function b(e){return null!=e&&e.hasOwnProperty(\"store\")&&e.hasOwnProperty(\"id\")&&\"number\"==typeof e.id}async function S(e,r,a){let t,s=!1;if(\"FeatureServer\"===r){const r=await n(e,{customParameters:a});s=!!r.layersJSON,t=r.layersJSON||r.serviceJSON}else t=await i(e,{customParameters:a});const l=t?.layers,o=t?.tables;return{layerIds:l?.map((e=>e.id)).reverse()||[],tableIds:o?.map((e=>e.id)).reverse()||[],layerInfos:s?l:[],tableInfos:s?o:[]}}async function w(e){return(0,c[e])()}async function v(e,r){return(await i(e,{customParameters:r})).tileInfo}export{m as fromUrl};\n"],"names":["y","m","e","r","_a","a","d","t","__vitePreload","f","p","s","l","I","o","n","c","v","i","_b","u","S","_c","_d","w","b"],"mappings":"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"}