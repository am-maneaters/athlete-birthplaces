{"version":3,"file":"BufferPool-6eda276f.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/cpuMapped/FreeList.js","../../node_modules/@arcgis/core/views/2d/engine/webgl/BufferPool.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isNone as t}from\"../../../../../core/maybe.js\";class a{constructor(t){if(this.next=null,!Array.isArray(t))return void(this.data=t);this.data=t[0];let e=this;for(let n=1;n<t.length;n++)e.next=new a([t[n]]),e=e.next}*values(){let t=this;for(;t;)yield t.data,t=t.next}forEach(t){let a=this;for(;a;)t(a.data),a=a.next}find(t){return t(this.data)?this:this.next?.find(t)}max(t,a=this){const e=t(this.data)>t(a.data)?this:a;return this.next?this.next.max(t,e):e}remove(t,a=null){return this===t?a?(a.next=this.next,a):this.next:this.next?.remove(t,this)??null}get last(){return this.next?this.next.last:this}}class e{constructor(e){this._head=null,t(e)||(this._head=new a(e))}get head(){return this._head}maxAvailableSpace(){if(t(this._head))return 0;const a=this._head.max((t=>t.end-t.start));return a.data.end-a.data.start}firstFit(a){if(t(this._head))return null;let e=null,n=this._head;for(;n;){const t=n.data.end-n.data.start;if(t===a)return e?e.next=n.next:this._head=n.next,n.data.start;if(t>a){const t=n.data.start;return n.data.start+=a,t}e=n,n=n.next}return null}free(e,n){const r=e+n;if(t(this._head)){const t=new a({start:e,end:r});return void(this._head=t)}if(r<=this._head.data.start){if(r===this._head.data.start)return void(this._head.data.start-=n);const t=new a({start:e,end:r});return t.next=this._head,void(this._head=t)}let s=this._head,d=s.next;for(;d;){if(d.data.start>=r){if(s.data.end===e){if(s.data.end+=n,s.data.end===d.data.start){const t=d.data.end-d.data.start;return s.data.end+=t,void(s.next=d.next)}return}if(d.data.start===r)return void(d.data.start-=n);const t=new a({start:e,end:r});return t.next=s.next,void(s.next=t)}s=d,d=d.next}if(e===s.data.end)return void(s.data.end+=n);const i=new a({start:e,end:r});s.next=i}}export{e as FreeList,a as List};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport has from\"../../../../core/has.js\";import{isSome as t,unwrapOrThrow as e,isNone as s}from\"../../../../core/maybe.js\";import{FreeList as r}from\"./cpuMapped/FreeList.js\";const a=has(\"esri-2d-log-allocations\");class i{constructor(t,e){this._array=t,this._pool=e}get array(){return this._array}get length(){return this._array.length}static create(t,e){const s=e.acquire(t);return new i(s,e)}expand(t){const e=this._pool.acquire(t);e.set(this._array),this._pool.release(this._array),this._array=e}destroy(){this._pool.release(this._array)}set(t,e){this._array.set(t._array,e)}slice(){const t=this._pool.acquire(this._array.byteLength);return t.set(this._array),new i(t,this._pool)}}class o{constructor(){this._data=new ArrayBuffer(o.BYTE_LENGTH),this._freeList=new r({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64e6}get buffer(){return this._data}allocate(t){const e=this._freeList.firstFit(t);return s(e)?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}free(t){this._freeList.free(t.byteOffset,t.byteLength)}}class n{constructor(){this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*o.BYTE_LENGTH}acquire(s){if(this._bytesAllocated+=s,a&&console.log(`Allocating ${s}, (${this._bytesAllocated} / ${this._bytesTotal})`),s>o.BYTE_LENGTH)return new Uint32Array(s/Uint32Array.BYTES_PER_ELEMENT);for(const e of this._pages){const r=e.allocate(s);if(t(r))return r}return e(this._addPage().allocate(s),\"Expected to allocate page\")}release(t){this._bytesAllocated-=t.byteLength,a&&console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const e=this._pagesByBuffer.get(t.buffer);e&&e.free(t)}_addPage(){const t=new o;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}}export{n as BufferPool,i as TypedBuffer};\n"],"names":["a","n","_a","e","t","r","d","i","has","s","o"],"mappings":"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"}