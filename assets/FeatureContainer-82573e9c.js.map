{"version":3,"file":"FeatureContainer-82573e9c.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/WGLRendererInfo.js","../../node_modules/@arcgis/core/views/2d/engine/FeatureContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{unwrapOr as e,unwrap as t,isSome as i}from\"../../../../core/maybe.js\";import{pt2px as s}from\"../../../../core/screenUtils.js\";import{getMetersPerUnitForSR as a}from\"../../../../core/unitUtils.js\";import{meterIn as r}from\"../../../../renderers/support/lengthUtils.js\";import{isDefined as l,isNumber as o}from\"./Utils.js\";import{Technique as n}from\"./techniques/Technique.js\";import{getTechniqueFromRenderer as v}from\"./techniques/utils.js\";import{getWebGLCapabilities as u}from\"../../../webgl/capabilities.js\";function c(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}class h{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:\"geographic\",vvOpacityEnabled:!1},this._technique=n}getSizeVVFieldStops(i){const s=this._vvSizeFieldStops;if(s)switch(s.type){case\"static\":return s;case\"level-dependent\":return e(s.levels[i],(()=>{let e=1/0,a=0;for(const t in s.levels){const s=parseFloat(t),r=Math.abs(i-s);r<e&&(e=r,a=s)}if(e===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const r=2**((i-a)/2),l=t(s.levels[a]),o=new Float32Array(l.values);return o[2]*=r,o[3]*=r,{sizes:t(l.sizes),values:o}}));default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){i(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,i){this._updateEffects(i),this._vvInfo=t,this._technique=v(e),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,e)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:u(\"2d\").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(e){i(e)?this.outsideLabelsVisible=e.excludedLabelsVisible:this.outsideLabelsVisible=!1}_updateVisualVariables(e,t){const i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,!e)return;const n=e.size;if(n){if(i.vvSizeEnabled=!0,n.minMaxValue){const e=n.minMaxValue;let i,a;if(l(e.minSize)&&l(e.maxSize))if(o(e.minSize)&&o(e.maxSize))i=s(e.minSize),a=s(e.maxSize);else{const r=t.scale;i=s(c(r,e.minSize.stops)),a=s(c(r,e.maxSize.stops))}this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,i,a])}if(n.scaleStops&&(this.vvSizeScaleStopsValue=s(c(t.scale,n.scaleStops.stops))),n.unitValue){const e=a(t.spatialReference)/r[n.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/t.resolution}n.fieldStops&&(this._vvSizeFieldStops=n.fieldStops)}const v=e.color;v&&(i.vvColorEnabled=!0,this.vvColorValues.set(v.values),this.vvColors.set(v.colors));const u=e.opacity;u&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(u.values),this.vvOpacities.set(u.opacities));const h=e.rotation;h&&(i.vvRotationEnabled=!0,i.vvRotationType=h.type)}}export{h as WGLRendererInfo};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{createResolver as e}from\"../../../core/promiseUtils.js\";import t from\"../../../core/Queue.js\";import{AttributeStoreView as r}from\"./webgl/AttributeStoreView.js\";import s from\"./webgl/TileContainer.js\";import{WGLRendererInfo as i}from\"./webgl/WGLRendererInfo.js\";class o extends s{constructor(e){super(e),this._rendererInfo=new i,this._materialItemsRequestQueue=new t,this.attributeView=new r((()=>this.onAttributeStoreUpdate()))}destroy(){this.children.forEach((e=>e.destroy())),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}async getMaterialItems(t,r){if(!t||0===t.length)return[];const s=e();return this._materialItemsRequestQueue.push({items:t,abortOptions:r,resolver:s}),this.requestRender(),s.promise}doRender(e){if(e.context.capabilities.enable(\"textureFloat\"),e.context.capabilities.enable(\"vao\"),this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}updateTransforms(e){if(this.children.some((e=>e.hasData)))for(const t of this.children)t.setTransform(e)}createRenderParams(e){const t=super.createRenderParams(e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:s}){const{painter:i,pixelRatio:o}=e,a=t.map((e=>i.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,r)));Promise.all(a).then((e=>{if(!this.stage)return void s.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));s.resolve(r)}),s.reject)}}export{o as FeatureContainer};\n"],"names":["c","e","t","i","h","n","s","a","r","l","o","v","u"],"mappings":"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"}